# UIè®¾è®¡

# æ ¸å¿ƒåŠŸèƒ½ç•Œé¢æ¼”ç¤º

## ç™»å½•ç•Œé¢

| ![image-20201114113124996](UIè®¾è®¡.assets/image-20201114113124996.png) |
| :----------------------------------------------------------: |
|                      å›¾ ç™»å½•å¯¹è¯æ¡†ç•Œé¢                       |



## èŠå¤©çª—å£ç•Œé¢

### èŠå¤©å±•ç¤º

| ![image-20201115010825825](UIè®¾è®¡.assets/image-20201115010825825.png) |
| :----------------------------------------------------------: |
|                        å›¾ èŠå¤©æ ‡ç­¾é¡µ                         |



| åºå· |         åç§°         |
| :--: | :------------------: |
|  â‘    | èŠå¤©/æ–‡ä»¶åˆ‡æ¢æ ‡ç­¾é¡µ  |
|  â‘¡   |    èŠå¤©å†…å®¹å±•ç¤ºåŒº    |
|  â‘¢   |   åœ¨çº¿ç”¨æˆ·å±•ç¤ºåˆ—è¡¨   |
|  â‘£   |     æ–‡ä»¶ä¸Šä¼ æŒ‰é’®     |
|  â‘¤   | è¡¨æƒ…ç¬¦å·é¢æ¿æ‰“å¼€æŒ‰é’® |
|  â‘¥   |    èŠå¤©å†…å®¹ç¼–è¾‘åŒº    |



### è¡¨æƒ…ç¬¦å·é¢æ¿

| ![image-20201114120502667](UIè®¾è®¡.assets/image-20201114120502667.png) |
| :----------------------------------------------------------: |
|                       å›¾ è¡¨æƒ…ç¬¦å·é¢æ¿                        |



## æ–‡ä»¶ç•Œé¢

### æ–‡ä»¶å±•ç¤º

| ![image-20201114115822559](UIè®¾è®¡.assets/image-20201114115822559.png) |
| :----------------------------------------------------------: |
|                        å›¾ æ–‡ä»¶æ ‡ç­¾é¡µ                         |



| åºå· |          åç§°          |
| :--: | :--------------------: |
|  â‘    |      æ–‡ä»¶ä¸ªæ•°æ ‡ç­¾      |
|  â‘¡   |      æ–‡ä»¶ä¸Šä¼ æŒ‰é’®      |
|  â‘¢   | ç¾¤æ–‡ä»¶å±•ç¤ºè¡¨æ ¼åˆ·æ–°æŒ‰é’® |
|  â‘£   |      æ–‡ä»¶ä¸‹è½½æŒ‰é’®      |
|  â‘¤   |     ç¾¤æ–‡ä»¶å±•ç¤ºè¡¨æ ¼     |



### æ–‡ä»¶ä¸Šä¼ 

| ![image-20201114115904575](UIè®¾è®¡.assets/image-20201114115904575.png) |
| :----------------------------------------------------------: |
|                      å›¾ æ–‡ä»¶ä¸Šä¼ å¯¹è¯æ¡†                       |



### æ–‡ä»¶ä¸‹è½½

| ![image-20201114120213740](UIè®¾è®¡.assets/image-20201114120213740.png) |
| :----------------------------------------------------------: |
|                      å›¾ æ–‡ä»¶ä¸‹è½½å¯¹è¯æ¡†                       |



# æ¶ˆæ¯æ°”æ³¡è®¾è®¡

## æ¶ˆæ¯æ°”æ³¡ç±»å‹

æ¶ˆæ¯æ°”æ³¡åˆ†ä¸‰ç§ç±»å‹ã€‚

### å…¬å…±é€šçŸ¥

æ˜¾ç¤ºç”¨æˆ·ä¸Šä¸‹çº¿å’Œæ–‡ä»¶ä¸Šä¼ çš„æ¶ˆæ¯ï¼Œåœ¨èŠå¤©å±•ç¤ºåŒºä¸­é—´ä½ç½®ï¼Œæ°”æ³¡å‘ˆç°ç°è‰²èƒŒæ™¯è‰²ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

| ![image-20201115101528718](UIè®¾è®¡.assets/image-20201115101528718.png) |
| :----------------------------------------------------------: |
|                     å›¾ å…¬å…±é€šçŸ¥æ¶ˆæ¯æ°”æ³¡                      |



### è‡ªå·±çš„æ¶ˆæ¯

æ˜¾ç¤ºç”¨æˆ·è‡ªå·±å‘å‡ºçš„èŠå¤©æ¶ˆæ¯ï¼Œåœ¨èŠå¤©å±•ç¤ºåŒºå³è¾¹ä½ç½®ï¼Œæ°”æ³¡å‘ˆç°ç»¿è‰²èƒŒæ™¯è‰²ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

| ![image-20201115101652499](UIè®¾è®¡.assets/image-20201115101652499.png) |
| :----------------------------------------------------------: |
|                        å›¾ è‡ªå·±çš„æ¶ˆæ¯                         |



### ä»–äººçš„æ¶ˆæ¯

æ˜¾ç¤ºå…¶ä»–ç”¨æˆ·å‘å‡ºçš„èŠå¤©æ¶ˆæ¯ï¼Œåœ¨èŠå¤©å±•ç¤ºåŒºå·¦è¾¹ä½ç½®ï¼Œæ°”æ³¡å‘ˆç°ç™½è‰²èƒŒæ™¯è‰²ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

| ![image-20201115101849920](UIè®¾è®¡.assets/image-20201115101954340.png) |
| :----------------------------------------------------------: |
|                         å›¾ ä»–äººæ¶ˆæ¯                          |



## æºç å®ç°

åœ¨mainboard.pyæºæ–‡ä»¶ä¸­ï¼Œé€šè¿‡è°ƒç”¨refresh_chatMsgShowListWidget()å‡½æ•°æ ¹æ®ä¼ å…¥çš„å‚æ•°æ¥ç”Ÿæˆå¯¹åº”çš„æ°”æ³¡

```python
def refresh_chatMsgShowListWidget(self, userName, msg, isMe=1, msgBgColor='#9eea6a',userHeader='ui/ico/ico.png'):
    '''
    æ›´æ–°èŠå¤©å±•ç¤ºåŒº/ç”Ÿæˆæ¶ˆæ¯æ°”æ³¡
    :param userName: èŠå¤©æ¶ˆæ¯å‘å‡ºè€…
    :param msg: æ¶ˆæ¯å†…å®¹
    :param isMe: æ¶ˆæ¯æ°”æ³¡ç±»å‹
    :param msgBgColor: æ¶ˆæ¯æ°”æ³¡èƒŒæ™¯è‰²
    :param userHeader: èŠå¤©æ¶ˆæ¯æ°”æ³¡å¤´åƒ
    :return: 
    '''
    lwit = QListWidgetItem() # åˆ—è¡¨é¡¹
    self.chatMsgShowListWidget.addItem(lwit)
    # æ ¹æ®isMeçš„å€¼ç”Ÿæˆç›¸åº”çš„æ¶ˆæ¯æ°”æ³¡
    if 0 == isMe: 
        mif = self.newMsgItemInformFrame(msg, msgBgColor) # ç”Ÿæˆå…¬å…±é€šçŸ¥æ°”æ³¡
    else:
        mif = self.newMsgItemChatFrame(userName, msg, isMe, msgBgColor, userHeader) # ç”ŸæˆèŠå¤©æ°”æ³¡

    # è°ƒæ•´åˆ—è¡¨é¡¹å¤§å°
    lwit.setSizeHint(QSize(400, mif.height()))  
    # æŠŠæ¶ˆæ¯æ°”æ³¡ä¸åˆ—è¡¨é¡¹ç»‘å®šåœ¨ä¸€èµ·ï¼Œæ·»åŠ åˆ°åˆ—è¡¨ï¼ˆèŠå¤©å±•ç¤ºåŒºï¼‰ä¸­
    self.chatMsgShowListWidget.setItemWidget(lwit, mif)

    # æ»šåŠ¨æ¡åˆ°æœ«å°¾
    self.chatMsgShowListWidget.setCurrentRow(self.chatMsgShowListWidget.count() - 1)
```



# è¡¨æƒ…ç¬¦å·é¢æ¿è®¾è®¡

## åŸºæœ¬åŸç†

åœ¨windowsç³»ç»Ÿä¸‹ï¼Œå¾®è½¯è¾“å…¥æ³•è‡ªå¸¦çš„è¡¨æƒ…ç¬¦å·ï¼Œä¼šè‡ªåŠ¨æŠŠå¯¹åº”å­—ç¬¦ä¸²è½¬æ¢æˆemojiè¡¨æƒ…ï¼Œè¡¨ç°å¦‚å›¾ï¼š



| ![image-20201114135033803](UIè®¾è®¡.assets/image-20201114135033803.png) |
| :----------------------------------------------------------: |
|                    å›¾ å‘½ä»¤è¡Œä¸­çš„è¡¨æƒ…ç¬¦å·                     |

| ![image-20201114135157467](UIè®¾è®¡.assets/image-20201114135157467.png) |
| :----------------------------------------------------------: |
|                     å›¾ ç•Œé¢ä¸­çš„è¡¨æƒ…ç¬¦å·                      |



å¾®è½¯è¾“å…¥æ³•çš„è¡¨æƒ…ç¬¦å·çš„bytesç¼–ç æ˜¯è¿ç»­çš„ï¼Œå¯ä»¥è®¾ç½®èµ·å§‹è¡¨æƒ…ç¬¦å·ï¼Œé€šè¿‡å¯¹è¡¨æƒ…ç¬¦å·çš„bytesç¼–ç è¿›è¡Œé€’å¢ï¼Œä»è€Œè·å–ä¸€å®šçš„è¡¨æƒ…ç¬¦å·å­—ç¬¦ä¸²ã€‚

## æºç å®ç°

åœ¨tools.pyæºæ–‡ä»¶è·å–è¡¨æƒ…ç¬¦å·ï¼Œä»£ç å¦‚ä¸‹ï¼š

```python
def getEmoji():
    '''
    è·å–å¾®è½¯è¾“å…¥æ³•çš„emoji
    :return: emojiåˆ—è¡¨
    '''
    emoji = []
    # æŠŠstrç±»å‹çš„è¡¨æƒ…ç¬¦å·è½¬æ¢æˆbytesç±»å‹
    start = int.from_bytes('ğŸ˜€'.encode(), byteorder='big', signed=False)
    end = int.from_bytes('ğŸ˜¼'.encode(),byteorder='big', signed=False)

    # å¯¹bytesç¼–ç è¿›è¡Œé€’å¢
    for str in range(start, end, 1):
        # æŠŠbytesç±»å‹è¡¨æƒ…ç¬¦å·è½¬æ¢æˆstrç±»å‹ï¼Œå¹¶å­˜å‚¨
        emoji.append(struct.pack('>L', str).decode())
    return emoji
```



åœ¨emojiboard.pyæºæ–‡ä»¶ä¸­å®ç°é¢æ¿è¡¨æ ¼æ•°æ®æ›´æ–°

```python
def refresh_emojiTableWidget(self):
    '''
    å¡«å……emojiè¡¨æ ¼å¹¶è®¾ç½®çª—å£å¤§å°
    :return:
    '''
    self.setWindowFlags(Qt.FramelessWindowHint | Qt.Popup) # è®¾ç½®çª—å£æ ·å¼ä¸ºæ— æ ‡é¢˜æ å’Œå¼¹å‡ºå¼é¡¶å±‚
    etw = self.emojiTableWidget # è¡¨æ ¼é¢æ¿
    etw.setRowCount(5) # è¡¨æ ¼åˆ—
    etw.setColumnCount(0) # è¡¨æ ¼è¡Œ

    emojiList = getEmoji() # è·å–è¡¨æƒ…ç¬¦å·åˆ—è¡¨
    rows = etw.rowCount() 
    index = 0 # è¡¨æƒ…ç¬¦å·åˆ—è¡¨ä¸‹æ ‡
    while(index < len(emojiList)):
        colPosition = etw.columnCount() # åˆ—ä½ç½®
        etw.insertColumn(colPosition) # æ’å…¥æ–°åˆ—
        # çºµå‘æ’å…¥
        for rowPosition in range(0, rows):
            if(index < len(emojiList)):
                # æŠŠè¡¨æƒ…ç¬¦å·æ’å…¥è¡¨æ ¼é¢æ¿ä¸­
                etw.setItem(rowPosition, colPosition, QTableWidgetItem(emojiList[index]))
                index += 1

    # è¡¨æ ¼ï¼Œçª—ä½“æ ¹æ®å†…å®¹è‡ªé€‚åº”å¤§å°
    etw.setFixedSize(etw.horizontalHeader().length() + etw.verticalHeader().width(), etw.height())
    self.setFixedSize(etw.width(),self.height())
```



# æ–‡ä»¶ä¸‹è½½è®¾è®¡

å› ä¸ºè¡¨æ ¼æ˜¯åŠ¨æ€ç”Ÿæˆçš„ï¼Œæ¯ä¸€ä¸ªä¸‹è½½æŒ‰é’®ä¹Ÿéœ€è¦éƒ½éœ€è¦åŠ¨æ€åœ°ç»‘å®šç‚¹å‡»äº‹ä»¶å“åº”å‡½æ•°ï¼Œè€Œæ¯ä¸€ä¸ªä¸‹è½½æŒ‰é’®çš„ç‚¹å‡»äº‹ä»¶å“åº”å‡½æ•°æ‰€éœ€è¦çš„å‚æ•°æ˜¯å›ºå®šå€¼ã€‚

`ä½¿ç”¨functools.partial()`å‡½æ•°å¯ä»¥æŠŠç‚¹å‡»äº‹ä»¶å“åº”å‡½æ•°ä¸å›ºå®šå‚æ•°è”ç³»èµ·æ¥ã€‚

## æºç å®ç°

åœ¨mainboard.pyæºæ–‡ä»¶çš„`refresh_filesShowTableWidget()`å‡½æ•°ä¸­å®ç°åŠ¨æ€ç»‘å®šå›ºå®šå€¼ã€‚

```python
fileDownloadPushButton.clicked.connect(
    functools.partial(self.on_fileDownloadPushButton_click, fileName, fileInfo['fileSize']))
```

